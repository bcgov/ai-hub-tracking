<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DocumentIntelligenceGuide | AI Services Hub</title>
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <style>
        :root {
            --bc-blue: #003366;
            --bc-gold: #fcba19;
            --bc-blue-dark: #002244;
            --bc-blue-light: #1a5a96;
            --text-primary: #313132;
            --text-secondary: #606060;
            --bg-light: #f2f2f2;
            --white: #ffffff;
            --gradient-hero: linear-gradient(135deg, #003366 0%, #1a5a96 50%, #003366 100%);
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.16);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Offset anchor scroll so the sticky header never covers the target */
        html {
            scroll-padding-top: 80px;
        }

        body {
            font-family: 'BC Sans', 'Noto Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--bg-light);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .bc-header {
            background: var(--gradient-hero);
            border-bottom: 4px solid var(--bc-gold);
            padding: 0.5rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-md);
        }

        .bc-header-brand {
            display: flex;
            align-items: center;
            gap: 1rem;
            text-decoration: none;
        }

        .bc-header-logo {
            height: 36px;
            width: auto;
            border-radius: 4px;
        }

        .bc-header-title {
            color: var(--white);
            font-size: 1.5rem;
            font-weight: 700;
        }

        .bc-header-subtitle {
            color: var(--bc-gold);
            font-size: 0.875rem;
        }

        /* Navigation with Dropdowns */
        .bc-nav {
            display: flex;
            gap: 0.25rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .bc-nav > a,
        .nav-dropdown > .nav-trigger {
            color: var(--white);
            text-decoration: none;
            padding: 0.6rem 1rem;
            border-radius: 4px;
            font-size: 0.9rem;
            transition: var(--transition);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            border: none;
            background: transparent;
            font-family: inherit;
        }

        .bc-nav > a:hover,
        .nav-dropdown:hover > .nav-trigger {
            background: rgba(255,255,255,0.15);
        }

        .bc-nav > a.active {
            background: var(--bc-gold);
            color: var(--bc-blue);
            font-weight: 600;
        }

        /* Dropdown */
        .nav-dropdown {
            position: relative;
        }

        .nav-trigger::after {
            content: '';
            border: solid currentColor;
            border-width: 0 2px 2px 0;
            display: inline-block;
            padding: 3px;
            transform: rotate(45deg);
            margin-top: -3px;
            transition: transform 0.2s;
        }

        .nav-dropdown:hover .nav-trigger::after {
            transform: rotate(-135deg);
            margin-top: 3px;
        }

        .nav-dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background: var(--white);
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            min-width: 220px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: var(--transition);
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .nav-dropdown:hover .nav-dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .nav-dropdown-menu a {
            display: block;
            padding: 0.75rem 1rem;
            color: var(--text-primary);
            text-decoration: none;
            transition: var(--transition);
            border-left: 3px solid transparent;
        }

        .nav-dropdown-menu a:hover {
            background: var(--bg-light);
            border-left-color: var(--bc-gold);
            color: var(--bc-blue);
        }

        .nav-dropdown-menu a.active {
            background: #fef9e7;
            border-left-color: var(--bc-gold);
            border-left-width: 4px;
            color: var(--bc-blue);
            font-weight: 600;
        }

        .nav-dropdown-menu a small {
            display: block;
            color: var(--text-secondary);
            font-size: 0.75rem;
            margin-top: 0.2rem;
        }

        /* Main Content */
        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            flex: 1;
            width: 100%;
        }

        /* Hero Section */
        .hero {
            background: var(--gradient-hero);
            color: var(--white);
            padding: 3rem 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
            box-shadow: var(--shadow-lg);
        }

        .hero h1 {
            color: var(--white);
            border: none;
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .hero p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Typography */
        h1 {
            color: var(--bc-blue);
            font-size: 2.25rem;
            margin-bottom: 1rem;
            border-bottom: 3px solid var(--bc-gold);
            padding-bottom: 0.5rem;
        }

        h2 {
            color: var(--bc-blue);
            font-size: 1.5rem;
            margin: 2rem 0 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        h2::before {
            content: '';
            width: 4px;
            height: 1.5rem;
            background: var(--bc-gold);
            border-radius: 2px;
        }

        h3 {
            color: var(--bc-blue-light);
            font-size: 1.25rem;
            margin: 1.5rem 0 0.75rem;
        }

        p {
            margin-bottom: 1rem;
        }

        /* Cards - Enhanced */
        .card {
            background: var(--white);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-sm);
            border-left: 4px solid var(--bc-blue);
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .card-gold {
            border-left-color: var(--bc-gold);
        }

        .card h3 {
            margin-top: 0;
        }

        /* Clickable Cards */
        a.card-link {
            display: block;
            text-decoration: none;
            color: inherit;
        }

        a.card-link .card {
            cursor: pointer;
        }

        a.card-link .card:hover {
            border-left-width: 6px;
        }

        .card-arrow {
            color: var(--bc-blue-light);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
            transition: var(--transition);
        }

        a.card-link:hover .card-arrow {
            gap: 0.75rem;
            color: var(--bc-blue);
        }

        /* Feature Cards */
        .feature-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .feature-icon.gold { background: rgba(252, 186, 25, 0.15); }
        .feature-icon.blue { background: rgba(0, 51, 102, 0.1); }
        .feature-icon.green { background: rgba(34, 197, 94, 0.1); }
        .feature-icon.purple { background: rgba(139, 92, 246, 0.1); }

        /* Stats */
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--bc-gold);
            line-height: 1;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Code blocks */
        pre {
            background: var(--bc-blue-dark);
            color: #e2e8f0;
            padding: 1.25rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1rem 0;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            font-size: 0.875rem;
            box-shadow: var(--shadow-sm);
        }

        code {
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            background: #e2e8f0;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-size: 0.875rem;
        }

        pre code {
            background: none;
            padding: 0;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            background: var(--white);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        th {
            background: var(--bc-blue);
            color: var(--white);
            padding: 0.875rem 1rem;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 0.875rem 1rem;
            border-bottom: 1px solid #e2e8f0;
        }

        tr:hover {
            background: #f8fafc;
        }

        tr:last-child td {
            border-bottom: none;
        }

        /* Lists */
        ul, ol {
            margin: 1rem 0;
            padding-left: 1.5rem;
        }

        li {
            margin-bottom: 0.5rem;
        }

        /* Links */
        a {
            color: var(--bc-blue-light);
            transition: var(--transition);
        }

        a:hover {
            color: var(--bc-blue);
        }

        /* Grid */
        .grid {
            display: grid;
            gap: 1.5rem;
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .grid-4 {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }

        /* Alerts */
        .alert {
            padding: 1rem 1.25rem;
            border-radius: 8px;
            margin: 1rem 0;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .alert > * {
            min-width: 0;
        }

        .alert-icon {
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .alert-info {
            background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
            border-left: 4px solid #0ea5e9;
        }

        .alert-warning {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left: 4px solid var(--bc-gold);
        }

        .alert-success {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            border-left: 4px solid #22c55e;
        }

        /* Image containers */
        .img-container {
            margin: 1.5rem 0;
            text-align: center;
        }

        .img-container img {
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-gold {
            background: var(--bc-gold);
            color: var(--bc-blue);
        }

        .badge-blue {
            background: var(--bc-blue);
            color: var(--white);
        }

        /* Accordion / Collapsible */
        details {
            background: var(--white);
            border-radius: 8px;
            margin-bottom: 0.75rem;
            box-shadow: var(--shadow-sm);
            border-left: 4px solid var(--bc-blue);
            overflow: hidden;
            transition: var(--transition);
        }

        details:hover {
            box-shadow: var(--shadow-md);
        }

        details[open] {
            border-left-color: var(--bc-gold);
        }

        summary {
            padding: 1rem 1.25rem;
            cursor: pointer;
            font-weight: 600;
            color: var(--bc-blue);
            display: flex;
            align-items: center;
            justify-content: space-between;
            list-style: none;
            user-select: none;
            transition: var(--transition);
        }

        summary::-webkit-details-marker {
            display: none;
        }

        summary::after {
            content: '';
            border: solid var(--bc-blue-light);
            border-width: 0 2px 2px 0;
            display: inline-block;
            padding: 4px;
            transform: rotate(-45deg);
            transition: transform 0.2s ease;
            flex-shrink: 0;
            margin-left: 1rem;
        }

        details[open] summary::after {
            transform: rotate(45deg);
        }

        summary:hover {
            background: var(--bg-light);
        }

        details[open] summary {
            border-bottom: 1px solid #e2e8f0;
            background: var(--bg-light);
        }

        .accordion-content {
            padding: 1rem 1.25rem;
        }

        .accordion-content p:last-child {
            margin-bottom: 0;
        }

        /* Accordion with badge */
        summary .badge {
            margin-left: auto;
            margin-right: 1rem;
        }

        /* Accordion group */
        .accordion-group {
            margin: 1rem 0;
        }

        .accordion-group details:last-child {
            margin-bottom: 0;
        }

        /* Footer */
        .site-footer {
            background: var(--bc-blue);
            color: var(--white);
            padding: 3rem 2rem;
            margin-top: auto;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
        }

        .footer-brand h4,
        .footer-links h4 {
            color: var(--bc-gold);
            margin-bottom: 0.75rem;
            font-size: 1rem;
        }

        .footer-brand p {
            color: #94a3b8;
            font-size: 0.875rem;
            margin: 0;
        }

        .footer-links ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .footer-links li {
            margin-bottom: 0.5rem;
        }

        .footer-links a {
            color: #94a3b8;
            text-decoration: none;
            font-size: 0.875rem;
            transition: var(--transition);
        }

        .footer-links a:hover {
            color: var(--bc-gold);
        }

        .footer-copyright {
            text-align: right;
        }

        .footer-copyright p {
            color: #64748b;
            font-size: 0.75rem;
            margin: 0;
        }

        .footer-meta {
            margin-top: 0.5rem !important;
            opacity: 0.7;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .bc-header {
                flex-direction: column;
                text-align: center;
                padding: 1rem;
            }

            .bc-nav {
                justify-content: center;
            }

            .nav-dropdown-menu {
                position: fixed;
                left: 1rem;
                right: 1rem;
                width: auto;
            }

            main {
                padding: 1rem;
            }

            h1 {
                font-size: 1.75rem;
            }

            .hero {
                padding: 2rem 1rem;
            }

            .hero h1 {
                font-size: 1.75rem;
            }

            .footer-content {
                text-align: center;
            }

            .footer-copyright {
                text-align: center;
            }
        }

        /* =====================================================================
           SEARCH – button, modal, results, breadcrumb, highlight
           ===================================================================== */

        /* Search button in header nav */
        .search-btn {
            color: var(--white);
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 6px;
            padding: 0.45rem 0.85rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.875rem;
            font-family: inherit;
            transition: var(--transition);
            white-space: nowrap;
        }

        .search-btn:hover {
            background: rgba(255,255,255,0.28);
        }

        .search-btn svg { flex-shrink: 0; }

        .search-btn-kbd {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            padding: 1px 6px;
            font-size: 0.72rem;
            line-height: 1.5;
            letter-spacing: 0.02em;
            border: 1px solid rgba(255,255,255,0.3);
        }

        /* Modal overlay */
        .search-modal {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: rgba(0, 20, 50, 0.65);
            backdrop-filter: blur(3px);
            -webkit-backdrop-filter: blur(3px);
            align-items: flex-start;
            justify-content: center;
            padding: 6vh 1rem 1rem;
        }

        .search-modal--active {
            display: flex;
        }

        /* Modal box */
        .search-box {
            background: var(--white);
            border-radius: 14px;
            box-shadow: 0 24px 72px rgba(0,0,0,0.35);
            width: 100%;
            max-width: 680px;
            max-height: 82vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            animation: search-appear 0.18s ease;
        }

        @keyframes search-appear {
            from { opacity: 0; transform: translateY(-14px) scale(0.97); }
            to   { opacity: 1; transform: translateY(0)  scale(1); }
        }

        /* Input row */
        .search-input-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.9rem 1.1rem;
            border-bottom: 1px solid #e5e9f0;
            flex-shrink: 0;
        }

        .search-input-row svg { color: var(--text-secondary); flex-shrink: 0; }

        #search-input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 1.05rem;
            color: var(--text-primary);
            background: transparent;
            font-family: inherit;
            min-width: 0;
        }

        #search-input::placeholder { color: #a0aec0; }

        .search-modal-close {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            font-size: 1.4rem;
            line-height: 1;
            padding: 0.2rem 0.45rem;
            border-radius: 6px;
            transition: background 0.15s, color 0.15s;
        }

        .search-modal-close:hover {
            background: var(--bg-light);
            color: var(--text-primary);
        }

        /* Results list */
        .search-results {
            overflow-y: auto;
            flex: 1;
        }

        .search-count {
            padding: 0.5rem 1.1rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
            border-bottom: 1px solid #f0f3f8;
            background: #fafbfd;
        }

        .search-result-item {
            display: block;
            padding: 0.9rem 1.1rem;
            border-bottom: 1px solid #f0f3f8;
            text-decoration: none;
            color: inherit;
            transition: background 0.12s;
            outline: none;
        }

        .search-result-item:hover,
        .search-result-item:focus {
            background: #f4f7fc;
        }

        .search-result-meta {
            font-size: 0.72rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: #996600;
            margin-bottom: 0.2rem;
        }

        .search-result-title {
            font-weight: 600;
            color: var(--bc-blue);
            margin-bottom: 0.3rem;
            font-size: 0.97rem;
        }

        .search-result-excerpt {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.55;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .search-result-item mark {
            background: rgba(252, 186, 25, 0.45);
            color: inherit;
            border-radius: 2px;
            padding: 0 1px;
        }

        .search-no-results {
            padding: 2.5rem 1rem;
            text-align: center;
            color: var(--text-secondary);
        }

        .search-no-results svg {
            display: block;
            margin: 0 auto 0.75rem;
            opacity: 0.4;
        }

        .search-no-results p { margin: 0; font-size: 0.95rem; }

        .search-loading {
            padding: 1.5rem;
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Modal footer hints */
        .search-hints {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.55rem 1.1rem;
            border-top: 1px solid #e5e9f0;
            background: #fafbfd;
            font-size: 0.75rem;
            color: var(--text-secondary);
            flex-shrink: 0;
        }

        .search-hints kbd {
            display: inline-block;
            background: var(--white);
            border: 1px solid #cbd5e1;
            border-radius: 4px;
            padding: 1px 5px;
            font-family: inherit;
            font-size: 0.72rem;
            line-height: 1.6;
        }

        /* ── Breadcrumb bar ───────────────────────────────────────────────── */
        #search-breadcrumb {
            display: none;
            background: var(--white);
            border: 1px solid #dde3ed;
            border-radius: 8px;
            padding: 0.65rem 1.1rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-sm);
        }

        .breadcrumb-nav {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.875rem;
            flex-wrap: wrap;
        }

        .breadcrumb-nav a {
            color: var(--bc-blue-light);
            text-decoration: none;
        }

        .breadcrumb-nav a:hover {
            text-decoration: underline;
            color: var(--bc-blue);
        }

        .breadcrumb-current {
            color: var(--text-primary);
            font-weight: 600;
        }

        .breadcrumb-sep { color: #94a3b8; }

        /* ── Section highlight flash ──────────────────────────────────────── */
        @keyframes section-flash {
            0%   { background-color: rgba(252, 186, 25, 0.45); box-shadow: 0 0 0 4px rgba(252,186,25,0.25); }
            60%  { background-color: rgba(252, 186, 25, 0.15); }
            100% { background-color: transparent; box-shadow: none; }
        }

        .search-highlight {
            animation: section-flash 2.2s ease-out forwards;
            border-radius: 4px;
        }

    </style>
    <script src="https://cdn.jsdelivr.net/npm/flexsearch@0.7.31/dist/flexsearch.bundle.js" defer></script>
    <script src="assets/search.js" defer id="search-script"></script>
</head>
<body>
    <header class="bc-header">
        <a href="index.html" class="bc-header-brand">
            <img src="assets/bc_citz_logo.jpg" alt="BC Government" class="bc-header-logo">
            <div>
                <div class="bc-header-title">AI Services Hub</div>
                <div class="bc-header-subtitle">Azure Landing Zone Infrastructure</div>
            </div>
        </a>
        <nav class="bc-nav">
            <a href="index.html" class="">Home</a>
            <div class="nav-dropdown">
                <span class="nav-trigger">For Tenants</span>
                <div class="nav-dropdown-menu">
                    <a href="services.html" class="">
                        AI Services
                        <small>Available models &amp; services catalogue</small>
                    </a>
                    <a href="language-service-pii.html" class="">
                        Language Service PII
                        <small>ML-based PII detection &amp; APIM</small>
                    </a>
                    <a href="apim-internal-endpoints.html" class="">
                        APIM Internal Endpoints
                        <small>tenant-info &amp; apim-keys API reference</small>
                    </a>
                    <a href="apim-key-rotation.html" class="">
                        APIM Key Rotation
                        <small>Subscription key auto-rotation</small>
                    </a>
                </div>
            </div>
            <div class="nav-dropdown">
                <span class="nav-trigger">For AI Hub Admins</span>
                <div class="nav-dropdown-menu">
                    <a href="playbooks.html" class="">
                        Playbooks
                        <small>Operational runbooks &amp; how-to guides</small>
                    </a>
                    <a href="oidc-setup.html" class="">
                        OIDC Setup
                        <small>GitHub to Azure authentication</small>
                    </a>
                    <a href="workflows.html" class="">
                        GitHub Workflows
                        <small>CI/CD automation</small>
                    </a>
                    <a href="terraform-reference.html" class="">
                        TF Reference
                        <small>Auto-generated from code</small>
                    </a>
                    <a href="technical-deep-dive.html" class="">
                        Technical Deep Dive
                        <small>Control/data plane &amp; Chisel architecture</small>
                    </a>
                </div>
            </div>
            <a href="diagrams.html" class="">Diagrams</a>
            <a href="decisions.html" class="">ADRs</a>
            <a href="cost.html" class="">Cost</a>
            <a href="faq.html" class="">FAQ</a>

            <!-- Search button -->
            <button class="search-btn" id="search-btn" type="button" aria-label="Search documentation">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                Search
                <span class="search-btn-kbd" aria-label="keyboard shortcut">⌘K</span>
            </button>
        </nav>
    </header>

    <!-- ── Search modal ──────────────────────────────────────────────────── -->
    <div class="search-modal" id="search-modal" role="dialog" aria-modal="true" aria-label="Search documentation">
        <div class="search-box">
            <div class="search-input-row">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                <input
                    type="search"
                    id="search-input"
                    placeholder="Search documentation…"
                    autocomplete="off"
                    spellcheck="false"
                    aria-label="Search query"
                />
                <button class="search-modal-close" id="search-modal-close" type="button" aria-label="Close search">✕</button>
            </div>
            <div class="search-results" id="search-results" role="listbox" aria-label="Search results"></div>
            <div class="search-hints" aria-hidden="true">
                <span><kbd>↑</kbd><kbd>↓</kbd> navigate</span>
                <span><kbd>↵</kbd> open</span>
                <span><kbd>Esc</kbd> close</span>
                <span style="margin-left:auto"><kbd>⌘K</kbd> or <kbd>Ctrl+K</kbd></span>
            </div>
        </div>
    </div>

    <main>
        <!-- Breadcrumb: injected by search.js when arriving from a search result -->
        <div id="search-breadcrumb" aria-label="Search breadcrumb"></div>

<h1 id="document-intelligence-guide">Document Intelligence Guide</h1>

<p>This guide covers integration patterns and SDK configuration for Azure Document Intelligence through the APIM gateway.</p>

<div class="alert alert-warning">
    <div class="alert-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 8v4"/><path d="M12 16h.01"/></svg>
    </div>
    <div>
        <strong>SDK Configuration Required</strong><br>
        When using Azure Document Intelligence SDKs through APIM, you must configure the SDK to use <code>api-key</code> instead of the default <code>Ocp-Apim-Subscription-Key</code> header.
    </div>
</div>

<h2 id="api-key-header-configuration">API Key Header Configuration</h2>

<h3 id="why-api-key">Why <code>api-key</code>?</h3>

<p>APIM is used as a unified gateway for multiple Azure AI services (OpenAI, Document Intelligence, AI Search, Storage). Azure's API Management can only be configured with a single subscription key header name across all APIs.</p>

<p>The platform uses <code>api-key</code> because:</p>
<ul>
    <li><strong>SDK Compatibility:</strong> OpenAI SDK and other AI service libraries expect <code>api-key</code></li>
    <li><strong>Industry Standard:</strong> <code>api-key</code> is a more widely recognized header name than APIM-specific headers</li>
    <li><strong>Developer Experience:</strong> Reduces confusion by using a consistent, familiar header across all services</li>
</ul>

<div class="card">
    <p><strong>Default Behavior vs Required Behavior:</strong></p>
    <table>
        <thead>
            <tr>
                <th>SDK</th>
                <th>Default Header</th>
                <th>APIM Expected Header</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Azure Document Intelligence SDK</td>
                <td><code>Ocp-Apim-Subscription-Key</code></td>
                <td><code>api-key</code></td>
            </tr>
            <tr>
                <td>Azure OpenAI SDK</td>
                <td><code>api-key</code></td>
                <td><code>api-key</code> ✓</td>
            </tr>
        </tbody>
    </table>
</div>

<h2 id="sdk-configuration-examples">SDK Configuration Examples</h2>

<h3 id="javascripttypescript-azure-restai-document-intelligence">JavaScript/TypeScript (<code>@azure-rest/ai-document-intelligence</code>)</h3>

<p>When using the <code>@azure-rest/ai-document-intelligence</code> npm package, configure the client to use <code>api-key</code> header:</p>

<pre><code>import DocumentIntelligence from "@azure-rest/ai-document-intelligence";

const endpoint = "https://apim-gateway.azure-api.net/tenant/documentintelligence";
const apiKey = "your-apim-subscription-key";

// Configure client with custom API key header name
const client = DocumentIntelligence(endpoint, { key: apiKey }, {
  credentials: {
    apiKeyHeaderName: "api-key",  // Override default "Ocp-Apim-Subscription-Key"
  },
});

// Use the client normally
const result = await client.path("/documentModels/{modelId}:analyze", "prebuilt-read")
  .post({
    contentType: "application/json",
    body: {
      urlSource: "https://example.com/document.pdf"
    }
  });
</code></pre>

<div class="alert alert-info">
    <div class="alert-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
    </div>
    <div>
        <strong>Key Point</strong><br>
        The <code>apiKeyHeaderName</code> configuration tells the SDK to send the subscription key using the <code>api-key</code> header instead of the default <code>Ocp-Apim-Subscription-Key</code>.
    </div>
</div>

<h3 id="python-azure-ai-documentintelligence">Python (<code>azure-ai-documentintelligence</code>)</h3>

<pre><code>from azure.ai.documentintelligence import DocumentIntelligenceClient
from azure.core.credentials import AzureKeyCredential
from azure.core.pipeline.policies import HeadersPolicy

endpoint = "https://apim-gateway.azure-api.net/tenant/documentintelligence"
api_key = "your-apim-subscription-key"

# Create custom headers policy to use api-key header
headers_policy = HeadersPolicy()
headers_policy.add_header("api-key", api_key)

# Create client with custom policy
client = DocumentIntelligenceClient(
    endpoint=endpoint,
    credential=AzureKeyCredential(api_key),
    headers_policy=headers_policy
)

# Alternatively, use custom header directly in requests
# Note: Some SDK versions may require different configuration approaches
</code></pre>

<div class="alert alert-warning">
    <div class="alert-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 8v4"/><path d="M12 16h.01"/></svg>
    </div>
    <div>
        <strong>Python SDK Note</strong><br>
        The Python SDK's approach to custom headers may vary by version. Check the SDK documentation for your specific version. Some versions may require setting headers differently or may not support custom API key header names. In such cases, use direct REST API calls with the <code>requests</code> library.
    </div>
</div>

<h3 id="net-azureaidocumentintelligence">.NET (<code>Azure.AI.DocumentIntelligence</code>)</h3>

<pre><code>using Azure;
using Azure.AI.DocumentIntelligence;
using Azure.Core.Pipeline;

string endpoint = "https://apim-gateway.azure-api.net/tenant/documentintelligence";
string apiKey = "your-apim-subscription-key";

// Create client options with custom header
var options = new DocumentIntelligenceClientOptions();
options.AddPolicy(new AddHeaderPolicy("api-key", apiKey), HttpPipelinePosition.PerCall);

// Create client
var client = new DocumentIntelligenceClient(
    new Uri(endpoint),
    new AzureKeyCredential(apiKey),
    options
);

// Custom policy to add api-key header
public class AddHeaderPolicy : HttpPipelineSynchronousPolicy
{
    private readonly string _headerName;
    private readonly string _headerValue;

    public AddHeaderPolicy(string headerName, string headerValue)
    {
        _headerName = headerName;
        _headerValue = headerValue;
    }

    public override void OnSendingRequest(HttpMessage message)
    {
        message.Request.Headers.Add(_headerName, _headerValue);
    }
}
</code></pre>

<h3 id="direct-rest-api-curl">Direct REST API (curl)</h3>

<p>If SDK configuration is complex or unavailable, use direct REST API calls:</p>

<pre><code># Analyze document with prebuilt-read model
curl -X POST "https://apim-gateway.azure-api.net/tenant/documentintelligence/documentModels/prebuilt-read:analyze?api-version=2024-07-31-preview" \
  -H "api-key: your-apim-subscription-key" \
  -H "Content-Type: application/json" \
  -d '{
    "urlSource": "https://example.com/document.pdf"
  }'

# Alternative: Use query parameter
curl -X POST "https://apim-gateway.azure-api.net/tenant/documentintelligence/documentModels/prebuilt-read:analyze?api-version=2024-07-31-preview&api-key=your-apim-subscription-key" \
  -H "Content-Type: application/json" \
  -d '{
    "urlSource": "https://example.com/document.pdf"
  }'
</code></pre>

<h2 id="async-operations-polling">Async Operations & Polling</h2>

<p>Document Intelligence async operations (document analysis, model training) return a <code>202 Accepted</code> response with an <code>Operation-Location</code> header for status polling.</p>

<div class="card card-gold">
    <h3 id="automatic-header-rewrite" style="margin-top: 0;">Automatic Header Rewrite</h3>
    <p>APIM automatically rewrites the <code>Operation-Location</code> header to point back through the APIM gateway instead of directly to the Document Intelligence backend.</p>

    <p><strong>Example transformation:</strong></p>
    <pre><code>Backend returns:
  Operation-Location: https://tenant-docint.cognitiveservices.azure.com/documentintelligence/documentModels/prebuilt-read/analyzeResults/abc123

APIM rewrites to:
  Operation-Location: https://apim-gateway.azure-api.net/tenant/documentintelligence/documentModels/prebuilt-read/analyzeResults/abc123
</code></pre>

    <p><strong>Why this matters:</strong></p>
    <ul>
        <li>SDKs automatically poll the <code>Operation-Location</code> URL</li>
        <li>Polling continues through APIM with consistent authentication</li>
        <li>No special SDK configuration needed for polling</li>
        <li>Works transparently with Document Intelligence SDK polling logic</li>
    </ul>
</div>

<h2 id="troubleshooting">Troubleshooting</h2>

<table>
    <thead>
        <tr>
            <th>Issue</th>
            <th>Cause</th>
            <th>Solution</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>401 Unauthorized</td>
            <td>SDK sending <code>Ocp-Apim-Subscription-Key</code> instead of <code>api-key</code></td>
            <td>Configure SDK to use <code>api-key</code> header as shown in examples above</td>
        </tr>
        <tr>
            <td>403 Forbidden</td>
            <td>Invalid or expired APIM subscription key</td>
            <td>Verify subscription key is valid in APIM portal</td>
        </tr>
        <tr>
            <td>Polling fails after initial request</td>
            <td><code>Operation-Location</code> header not being rewritten (rare)</td>
            <td>Verify tenant API policy includes <code>Operation-Location</code> rewrite logic in <code>&lt;outbound&gt;</code> section</td>
        </tr>
        <tr>
            <td>SDK throws "Invalid endpoint" error</td>
            <td>Endpoint URL must include <code>/tenant/documentintelligence</code> path</td>
            <td>Use full APIM path: <code>https://apim-gateway.azure-api.net/tenant/documentintelligence</code></td>
        </tr>
    </tbody>
</table>

<h2 id="additional-resources">Additional Resources</h2>

<ul>
    <li><a href="https://learn.microsoft.com/en-us/azure/ai-services/document-intelligence/">Azure Document Intelligence Documentation</a></li>
    <li><a href="https://www.npmjs.com/package/@azure-rest/ai-document-intelligence">@azure-rest/ai-document-intelligence npm package</a></li>
    <li><a href="https://pypi.org/project/azure-ai-documentintelligence/">azure-ai-documentintelligence Python package</a></li>
    <li><a href="https://www.nuget.org/packages/Azure.AI.DocumentIntelligence">Azure.AI.DocumentIntelligence NuGet package</a></li>
</ul>

<div class="alert alert-info">
    <div class="alert-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
    </div>
    <div>
        <strong>For APIM Technical Details</strong><br>
        See the <a href="https://github.com/bcgov/ai-hub-tracking/blob/main/infra-ai-hub/params/apim/README.md">APIM Policy README</a> for information about Operation-Location header rewriting, subscription key normalization, and other APIM policy behaviors.
    </div>
</div>
    </main>
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-brand">
                <h4>AI Services Hub</h4>
                <p>Infrastructure as Code for Azure Landing Zone deployments</p>
            </div>
            <div class="footer-links">
                <h4>Resources</h4>
                <ul>
                    <li><a href="https://github.com/bcgov/ai-hub-tracking">GitHub Repository</a></li>
                    <li><a href="assets/azure-oidc-complete-guide.svg" target="_blank">Architecture Diagram</a></li>
                </ul>
            </div>
            <div class="footer-links">
                <h4>Documentation</h4>
                <ul>
                    <li><a href="services.html">AI Services</a></li>
                    <li><a href="diagrams.html">Architecture Diagrams</a></li>
                    <li><a href="playbooks.html">Playbooks</a></li>
                    <li><a href="decisions.html">ADRs</a></li>
                    <li><a href="faq.html">FAQ</a></li>
                </ul>
            </div>
            <div class="footer-links">
                <h4>BC Government</h4>
                <ul>
                    <li><a href="https://www2.gov.bc.ca">gov.bc.ca</a></li>
                    <li><a href="https://digital.gov.bc.ca">Digital Office</a></li>
                </ul>
            </div>
            <div class="footer-copyright">
                <p>&copy; 2026 Province of British Columbia</p>
                <p class="footer-meta">Built with zero dependencies</p>
            </div>
        </div>
    </footer>

    <script>
        (function () {
            function scrollToWithHeaderOffset(el) {
                if (!el) return;
                const header = document.querySelector('.bc-header');
                const offset = (header ? header.getBoundingClientRect().height : 0) + 16;

                const top = el.getBoundingClientRect().top + window.scrollY - offset;
                window.scrollTo({ top: Math.max(0, top) });
            }

            function openDetailsFromHash() {
                const hash = window.location.hash;
                if (!hash || hash.length < 2) return;

                const id = hash.substring(1);
                const el = document.getElementById(id);
                if (el && el.tagName && el.tagName.toLowerCase() === 'details') {
                    el.open = true;
                    // Opening can change layout; adjust scroll after paint so the
                    // sticky header doesn't cover the <summary> title.
                    requestAnimationFrame(function () {
                        requestAnimationFrame(function () {
                            scrollToWithHeaderOffset(el);
                        });
                    });
                }
            }

            document.addEventListener('DOMContentLoaded', function () {
                openDetailsFromHash();
            });

            window.addEventListener('hashchange', function () {
                openDetailsFromHash();
            });

            // If user clicks the same #hash twice, hashchange won't fire.
            // This ensures ADR links always expand.
            document.addEventListener('click', function (e) {
                const link = e.target.closest && e.target.closest('a[href^="#"]');
                if (!link) return;

                const href = link.getAttribute('href');
                if (!href || href.length < 2) return;

                const id = href.substring(1);
                const el = document.getElementById(id);
                if (el && el.tagName && el.tagName.toLowerCase() === 'details') {
                    el.open = true;
                    requestAnimationFrame(function () {
                        requestAnimationFrame(function () {
                            scrollToWithHeaderOffset(el);
                        });
                    });
                }
            });
        })();
    </script>
</body>
</html>
