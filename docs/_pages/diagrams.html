<!-- TITLE: Architecture Diagrams -->
<!-- NAV: diagrams -->

<style>
/* SVG Viewer Styles */
.diagram-viewer {
    background: var(--white);
    border-radius: 12px;
    box-shadow: var(--shadow-lg);
    overflow: hidden;
    margin-bottom: 2rem;
}

.diagram-toolbar {
    background: var(--bc-blue);
    padding: 0.75rem 1rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.diagram-title {
    color: var(--white);
    font-weight: 600;
    font-size: 1rem;
}

.diagram-controls {
    display: flex;
    gap: 0.5rem;
    align-items: center;
}

.diagram-btn {
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.2);
    color: var(--white);
    padding: 0.4rem 0.75rem;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.85rem;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 0.3rem;
}

.diagram-btn:hover {
    background: rgba(255,255,255,0.2);
}

.diagram-btn.active {
    background: var(--bc-gold);
    color: var(--bc-blue);
    border-color: var(--bc-gold);
}

.zoom-display {
    color: var(--bc-gold);
    font-size: 0.85rem;
    min-width: 50px;
    text-align: center;
}

.diagram-container {
    position: relative;
    overflow: auto;
    background: linear-gradient(45deg, #f0f0f0 25%, transparent 25%),
                linear-gradient(-45deg, #f0f0f0 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #f0f0f0 75%),
                linear-gradient(-45deg, transparent 75%, #f0f0f0 75%);
    background-size: 20px 20px;
    background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
    background-color: #fafafa;
    min-height: 500px;
    max-height: 80vh;
}

.diagram-svg-wrapper {
    transform-origin: top left;
    transition: transform 0.3s ease;
    display: inline-block;
    min-width: 100%;
}

.diagram-svg-wrapper svg,
.diagram-svg-wrapper img {
    display: block;
    max-width: none;
}

/* Fullscreen mode */
.diagram-viewer.fullscreen {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 9999;
    border-radius: 0;
    margin: 0;
}

.diagram-viewer.fullscreen .diagram-container {
    max-height: calc(100vh - 50px);
    height: calc(100vh - 50px);
}

/* Diagram Gallery */
.diagram-gallery {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.diagram-card {
    background: var(--white);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: var(--shadow-sm);
    cursor: pointer;
    transition: var(--transition);
    border: 2px solid transparent;
}

.diagram-card:hover {
    box-shadow: var(--shadow-md);
    transform: translateY(-4px);
}

.diagram-card.active {
    border-color: var(--bc-gold);
    box-shadow: 0 0 0 3px rgba(252, 186, 25, 0.3);
}

.diagram-card-preview {
    height: 160px;
    overflow: hidden;
    background: var(--bg-light);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
}

.diagram-card-preview img,
.diagram-card-preview svg {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
}

.diagram-card-info {
    padding: 1rem;
    border-top: 3px solid var(--bc-gold);
}

.diagram-card-info h4 {
    margin: 0 0 0.5rem 0;
    color: var(--bc-blue);
    font-size: 1rem;
}

.diagram-card-info p {
    margin: 0;
    font-size: 0.85rem;
    color: var(--text-secondary);
}

/* Interactive SVG Elements */
.diagram-svg-wrapper [data-tooltip] {
    cursor: pointer;
}

.diagram-svg-wrapper [data-tooltip]:hover {
    filter: brightness(1.1);
}

/* Legend */
.diagram-legend {
    background: var(--white);
    border-radius: 8px;
    padding: 1rem;
    margin-top: 1rem;
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    justify-content: center;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.85rem;
}

.legend-color {
    width: 16px;
    height: 16px;
    border-radius: 4px;
}

/* Hotspots overlay */
.diagram-hotspots {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

.hotspot {
    position: absolute;
    pointer-events: auto;
    cursor: pointer;
    background: rgba(252, 186, 25, 0.3);
    border: 2px solid var(--bc-gold);
    border-radius: 8px;
    opacity: 0;
    transition: opacity 0.3s;
}

.diagram-container:hover .hotspot {
    opacity: 1;
}

.hotspot:hover {
    background: rgba(252, 186, 25, 0.5);
}

.hotspot-tooltip {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: var(--bc-blue);
    color: var(--white);
    padding: 0.5rem 0.75rem;
    border-radius: 4px;
    font-size: 0.8rem;
    white-space: nowrap;
    opacity: 0;
    visibility: hidden;
    transition: var(--transition);
    margin-bottom: 0.5rem;
}

.hotspot:hover .hotspot-tooltip {
    opacity: 1;
    visibility: visible;
}

/* Keyboard hints */
.keyboard-hints {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin-top: 0.5rem;
    font-size: 0.8rem;
    color: var(--text-secondary);
}

.kbd {
    background: var(--bg-light);
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    font-family: monospace;
    border: 1px solid #ddd;
}
</style>

<h1>Architecture Diagrams</h1>

<p>Interactive diagrams showing the OIDC authentication flow, infrastructure architecture, and deployment processes. Click any diagram to view it in the interactive viewer with zoom and pan controls.</p>

<h2>Select a Diagram</h2>

<h3 style="color: var(--bc-gold); margin-top: 0;">Architecture Overview</h3>
<div class="diagram-gallery" id="diagramGallery">
    <div class="diagram-card active" onclick="loadDiagram('architecture-layers', this)">
        <div class="diagram-card-preview">
            <img src="assets/architecture-layers.svg" alt="Architecture Layers Preview" onerror="this.parentElement.innerHTML='<div style=\'color:#666;font-size:0.9rem;\'>Coming Soon</div>'">
        </div>
        <div class="diagram-card-info">
            <h4>Architecture Layers</h4>
            <p>From Microsoft upstream to BC Gov adaptation to deployed environments</p>
        </div>
    </div>
    <div class="diagram-card" onclick="loadDiagram('full-stack', this)">
        <div class="diagram-card-preview">
            <img src="assets/full-stack-architecture.svg" alt="Full Stack Architecture Preview" onerror="this.parentElement.innerHTML='<div style=\'color:#666;font-size:0.9rem;\'>Coming Soon</div>'">
        </div>
        <div class="diagram-card-info">
            <h4>Full Stack Architecture</h4>
            <p>Complete BC Gov adapted AI Landing Zone with all services and layers</p>
        </div>
    </div>
    <div class="diagram-card" onclick="loadDiagram('multi-tenant', this)">
        <div class="diagram-card-preview">
            <img src="assets/multi-tenant-isolation.svg" alt="Multi-Tenant Isolation Preview" onerror="this.parentElement.innerHTML='<div style=\'color:#666;font-size:0.9rem;\'>Coming Soon</div>'">
        </div>
        <div class="diagram-card-info">
            <h4>Multi-Tenant Isolation</h4>
            <p>How ministries share the landing zone securely with data isolation</p>
        </div>
    </div>
    <div class="diagram-card" onclick="loadDiagram('data-flow', this)">
        <div class="diagram-card-preview">
            <img src="assets/data-flow.svg" alt="Data Flow Preview" onerror="this.parentElement.innerHTML='<div style=\'color:#666;font-size:0.9rem;\'>Coming Soon</div>'">
        </div>
        <div class="diagram-card-info">
            <h4>AI Request Data Flow</h4>
            <p>Complete request path from user through App Gateway, APIM to AI response</p>
        </div>
    </div>
    <div class="diagram-card" onclick="loadDiagram('avm-nested', this)">
        <div class="diagram-card-preview">
            <img src="assets/avm-nested-modules.svg" alt="AVM Nested Modules Preview" onerror="this.parentElement.innerHTML='<div style=\'color:#666;font-size:0.9rem;\'>Coming Soon</div>'">
        </div>
        <div class="diagram-card-info">
            <h4>AVM Nested Module Pattern</h4>
            <p>Platform deploys once, projects consume outputs - two-phase deployment</p>
        </div>
    </div>
    <div class="diagram-card" onclick="loadDiagram('three-steps-evolution', this)">
        <div class="diagram-card-preview">
            <img src="assets/three-steps-access-evolution.svg" alt="Three Steps Evolution Preview" onerror="this.parentElement.innerHTML='<div style=\'color:#666;font-size:0.9rem;\'>Coming Soon</div>'">
        </div>
        <div class="diagram-card-info">
            <h4>3-Step Access Evolution</h4>
            <p>Bastion â†’ Container Apps â†’ Chisel+App Services cost comparison</p>
        </div>
    </div>
    <div class="diagram-card" onclick="loadDiagram('chisel-detail', this)">
        <div class="diagram-card-preview">
            <img src="assets/chisel-tunnel-detail.svg" alt="Chisel Tunnel Detail Preview" onerror="this.parentElement.innerHTML='<div style=\'color:#666;font-size:0.9rem;\'>Coming Soon</div>'">
        </div>
        <div class="diagram-card-info">
            <h4>Chisel Tunnel Detail</h4>
            <p>How HTTPS tunnel from laptop reaches private endpoints via App Service</p>
        </div>
    </div>
    <div class="diagram-card" onclick="loadDiagram('terraform-keyvault', this)">
        <div class="diagram-card-preview">
            <img src="assets/when-terraform-needs-keyvault.svg" alt="When Terraform Needs KeyVault Preview" onerror="this.parentElement.innerHTML='<div style=\'color:#666;font-size:0.9rem;\'>Coming Soon</div>'">
        </div>
        <div class="diagram-card-info">
            <h4>When Terraform Needs Key Vault</h4>
            <p>Data plane vs control plane operations with real examples</p>
        </div>
    </div>
</div>

<h3 style="color: #ef4444; margin-top: 1.5rem;">Stakeholder Infographics (Share These!)</h3>
<div class="diagram-gallery">
    <div class="diagram-card" onclick="loadDiagram('tenant-rg-model', this)">
        <div class="diagram-card-preview">
            <img src="assets/tenant-resource-group-model.svg" alt="Tenant RG Model Preview" onerror="this.parentElement.innerHTML='<div style=\'color:#666;font-size:0.9rem;\'>Coming Soon</div>'">
        </div>
        <div class="diagram-card-info">
            <h4>Tenant Resource Group Model</h4>
            <p>One-pager: Per-ministry RG structure, IP allocation, AVM modules, what's included</p>
        </div>
    </div>
    <div class="diagram-card" onclick="loadDiagram('ms-vs-bcgov', this)">
        <div class="diagram-card-preview">
            <img src="assets/microsoft-vs-bcgov-comparison.svg" alt="MS vs BC Gov Preview" onerror="this.parentElement.innerHTML='<div style=\'color:#666;font-size:0.9rem;\'>Coming Soon</div>'">
        </div>
        <div class="diagram-card-info">
            <h4>Microsoft vs BC Gov</h4>
            <p>Side-by-side: What Microsoft assumes vs what BC Gov requires</p>
        </div>
    </div>
    <div class="diagram-card" onclick="loadDiagram('whats-included', this)">
        <div class="diagram-card-preview">
            <img src="assets/whats-included-scope.svg" alt="Scope Infographic Preview" onerror="this.parentElement.innerHTML='<div style=\'color:#666;font-size:0.9rem;\'>Coming Soon</div>'">
        </div>
        <div class="diagram-card-info">
            <h4>What's Included / Not</h4>
            <p>Included, conditional, and out-of-scope services with IP budget guide</p>
        </div>
    </div>
    <div class="diagram-card" onclick="loadDiagram('ip-budget', this)">
        <div class="diagram-card-preview">
            <img src="assets/ip-budget-breakdown.svg" alt="IP Budget Breakdown Preview" onerror="this.parentElement.innerHTML='<div style=\'color:#666;font-size:0.9rem;\'>Coming Soon</div>'">
        </div>
        <div class="diagram-card-info">
            <h4>IP Budget Breakdown</h4>
            <p>Detailed IP allocation: base infrastructure, per-tenant consumption, 50 IP calculation</p>
        </div>
    </div>
</div>

<h3 style="color: var(--bc-blue); margin-top: 1.5rem;">Network & Infrastructure</h3>
<div class="diagram-gallery">
    <div class="diagram-card" onclick="loadDiagram('network-detailed', this)">
        <div class="diagram-card-preview">
            <img src="assets/networking-architecture-detailed.svg" alt="Networking Architecture Preview" onerror="this.parentElement.innerHTML='<div style=\'color:#666;font-size:0.9rem;\'>Coming Soon</div>'">
        </div>
        <div class="diagram-card-info">
            <h4>Networking Architecture (Detailed)</h4>
            <p>Complete network diagram: VNets, subnets, NSGs, traffic flow, private endpoints, IP budgets</p>
        </div>
    </div>
    <div class="diagram-card" onclick="loadDiagram('network-environments', this)">
        <div class="diagram-card-preview">
            <img src="assets/network-environments.svg" alt="Network Environments Preview" onerror="this.parentElement.innerHTML='<div style=\'color:#666;font-size:0.9rem;\'>Coming Soon</div>'">
        </div>
        <div class="diagram-card-info">
            <h4>Network Environments</h4>
            <p>All 4 VNets (prod, test, dev, tools) with subnet allocations and NSG rules</p>
        </div>
    </div>
    <div class="diagram-card" onclick="loadDiagram('network-arch', this)">
        <div class="diagram-card-preview">
            <img src="assets/network-architecture.svg" alt="Network Architecture Preview" onerror="this.parentElement.innerHTML='<div style=\'color:#666;font-size:0.9rem;\'>Coming Soon</div>'">
        </div>
        <div class="diagram-card-info">
            <h4>Network Architecture</h4>
            <p>VNet topology, subnets, NSGs, and Bastion connectivity</p>
        </div>
    </div>
</div>

<h3 style="color: #8b5cf6; margin-top: 1.5rem;">Platform Access & Security</h3>
<div class="diagram-gallery">
    <div class="diagram-card" onclick="loadDiagram('control-data-plane', this)">
        <div class="diagram-card-preview">
            <img src="assets/control-vs-data-plane.svg" alt="Control vs Data Plane Preview" onerror="this.parentElement.innerHTML='<div style=\'color:#666;font-size:0.9rem;\'>Coming Soon</div>'">
        </div>
        <div class="diagram-card-info">
            <h4>Control vs Data Plane</h4>
            <p>Why OIDC works for some operations but not others with private endpoints</p>
        </div>
    </div>
    <div class="diagram-card" onclick="loadDiagram('access-methods', this)">
        <div class="diagram-card-preview">
            <img src="assets/access-methods-architecture.svg" alt="Access Methods Preview" onerror="this.parentElement.innerHTML='<div style=\'color:#666;font-size:0.9rem;\'>Coming Soon</div>'">
        </div>
        <div class="diagram-card-info">
            <h4>Access Methods Architecture</h4>
            <p>Four interchangeable paths: GitHub runners, self-hosted, Bastion, Chisel</p>
        </div>
    </div>
    <div class="diagram-card" onclick="loadDiagram('who-deploys-what', this)">
        <div class="diagram-card-preview">
            <img src="assets/who-deploys-what.svg" alt="Who Deploys What Preview" onerror="this.parentElement.innerHTML='<div style=\'color:#666;font-size:0.9rem;\'>Coming Soon</div>'">
        </div>
        <div class="diagram-card-info">
            <h4>Who Deploys What</h4>
            <p>Platform Team vs Project Teams: Who owns what infrastructure</p>
        </div>
    </div>
    <div class="diagram-card" onclick="loadDiagram('deployment-scenarios', this)">
        <div class="diagram-card-preview">
            <img src="assets/deployment-scenarios.svg" alt="Deployment Scenarios Preview" onerror="this.parentElement.innerHTML='<div style=\'color:#666;font-size:0.9rem;\'>Coming Soon</div>'">
        </div>
        <div class="diagram-card-info">
            <h4>Deployment Scenarios</h4>
            <p>Three paths: Project team, Platform admin, Solo dev with costs</p>
        </div>
    </div>
</div>

<h3 style="color: #22c55e; margin-top: 1.5rem;">Authentication & CI/CD</h3>
<div class="diagram-gallery">
    <div class="diagram-card" onclick="loadDiagram('oidc-complete', this)">
        <div class="diagram-card-preview">
            <img src="assets/azure-oidc-complete-guide.svg" alt="OIDC Complete Guide Preview">
        </div>
        <div class="diagram-card-info">
            <h4>OIDC Complete Guide</h4>
            <p>Full authentication flow, token lifecycle, and architecture overview</p>
        </div>
    </div>
    <div class="diagram-card" onclick="loadDiagram('token-flow', this)">
        <div class="diagram-card-preview">
            <img src="assets/token-flow.svg" alt="Token Flow Preview" onerror="this.parentElement.innerHTML='<div style=\'color:#666;font-size:0.9rem;\'>Coming Soon</div>'">
        </div>
        <div class="diagram-card-info">
            <h4>Token Exchange Flow</h4>
            <p>Detailed JWT token exchange between GitHub and Azure</p>
        </div>
    </div>
    <div class="diagram-card" onclick="loadDiagram('deployment-pipeline', this)">
        <div class="diagram-card-preview">
            <img src="assets/deployment-pipeline.svg" alt="Deployment Pipeline Preview" onerror="this.parentElement.innerHTML='<div style=\'color:#666;font-size:0.9rem;\'>Coming Soon</div>'">
        </div>
        <div class="diagram-card-info">
            <h4>Deployment Pipeline</h4>
            <p>GitHub Actions workflow stages and Terraform execution</p>
        </div>
    </div>
</div>

<h3 style="color: #0078d4; margin-top: 1.5rem;">Microsoft Reference (Upstream)</h3>
<div class="diagram-gallery">
    <div class="diagram-card" onclick="loadDiagram('ms-with-platform', this)">
        <div class="diagram-card-preview">
            <img src="assets/AI-Landing-Zone-with-platform.png" alt="MS Reference With Platform" onerror="this.parentElement.innerHTML='<div style=\'color:#666;font-size:0.9rem;\'>Coming Soon</div>'">
        </div>
        <div class="diagram-card-info">
            <h4>MS: With Platform LZ</h4>
            <p>Microsoft's reference architecture with Platform Landing Zone (recommended)</p>
        </div>
    </div>
    <div class="diagram-card" onclick="loadDiagram('ms-without-platform', this)">
        <div class="diagram-card-preview">
            <img src="assets/AI-Landing-Zone-without-platform.png" alt="MS Reference Without Platform" onerror="this.parentElement.innerHTML='<div style=\'color:#666;font-size:0.9rem;\'>Coming Soon</div>'">
        </div>
        <div class="diagram-card-info">
            <h4>MS: Without Platform LZ</h4>
            <p>Microsoft's standalone application landing zone reference</p>
        </div>
    </div>
</div>

<h2>Interactive Viewer</h2>

<div class="diagram-viewer" id="diagramViewer">
    <div class="diagram-toolbar">
        <span class="diagram-title" id="currentDiagramTitle">Architecture Layers (Upstream to Deployment)</span>
        <div class="diagram-controls">
            <button class="diagram-btn" onclick="zoomOut()" title="Zoom Out (-)">
                <span>âˆ’</span> Zoom Out
            </button>
            <span class="zoom-display" id="zoomLevel">100%</span>
            <button class="diagram-btn" onclick="zoomIn()" title="Zoom In (+)">
                <span>+</span> Zoom In
            </button>
            <button class="diagram-btn" onclick="resetZoom()" title="Reset (0)">Reset</button>
            <button class="diagram-btn" onclick="fitToWidth()" title="Fit Width (W)">Fit Width</button>
            <button class="diagram-btn" onclick="toggleFullscreen()" id="fullscreenBtn" title="Fullscreen (F)">
                â›¶ Fullscreen
            </button>
            <a class="diagram-btn" id="downloadBtn" href="assets/architecture-layers.svg" download title="Download SVG">
                â†“ Download
            </a>
        </div>
    </div>
    <div class="diagram-container" id="diagramContainer">
        <div class="diagram-svg-wrapper" id="svgWrapper">
            <img src="assets/architecture-layers.svg" alt="Architecture Layers" id="currentDiagram">
        </div>
    </div>
</div>

<div class="keyboard-hints">
    <span><span class="kbd">+</span> / <span class="kbd">-</span> Zoom</span>
    <span><span class="kbd">0</span> Reset</span>
    <span><span class="kbd">W</span> Fit Width</span>
    <span><span class="kbd">F</span> Fullscreen</span>
    <span><span class="kbd">Esc</span> Exit Fullscreen</span>
</div>

<div class="diagram-legend">
    <div class="legend-item">
        <div class="legend-color" style="background: #003366;"></div>
        <span>BC Blue - Primary elements</span>
    </div>
    <div class="legend-item">
        <div class="legend-color" style="background: #fcba19;"></div>
        <span>BC Gold - Highlights & actions</span>
    </div>
    <div class="legend-item">
        <div class="legend-color" style="background: #22c55e;"></div>
        <span>Green - Success states</span>
    </div>
    <div class="legend-item">
        <div class="legend-color" style="background: #0078d4;"></div>
        <span>Azure Blue - Azure services</span>
    </div>
</div>

<h2>Diagram Descriptions</h2>

<div class="grid grid-2">
    <div class="card" style="border-left-color: #fcba19;">
        <h3 style="margin-top: 0;">OIDC Complete Guide</h3>
        <p>The comprehensive diagram showing:</p>
        <ul style="margin-bottom: 0;">
            <li><strong>Section 1:</strong> One-time setup process and prerequisites</li>
            <li><strong>Section 2:</strong> Token lifecycle and 5-step exchange flow</li>
            <li><strong>Section 3:</strong> Terraform backend and workflow configuration</li>
            <li><strong>Section 4:</strong> Complete architecture with all components</li>
            <li><strong>Section 5:</strong> Quick reference checklist and troubleshooting</li>
        </ul>
    </div>
    <div class="card" style="border-left-color: #8b5cf6;">
        <h3 style="margin-top: 0;">Token Exchange Flow</h3>
        <p>Detailed sequence diagram showing:</p>
        <ul style="margin-bottom: 0;">
            <li>GitHub Actions requesting OIDC token</li>
            <li>JWT claims and audience configuration</li>
            <li>Azure AD token validation</li>
            <li>Federated credential matching</li>
            <li>Access token issuance and scope</li>
        </ul>
    </div>
    <div class="card" style="border-left-color: #22c55e;">
        <h3 style="margin-top: 0;">Network Architecture</h3>
        <p>Infrastructure topology showing:</p>
        <ul style="margin-bottom: 0;">
            <li>Virtual Network and address spaces</li>
            <li>Subnet segmentation strategy</li>
            <li>NSG rules and traffic flow</li>
            <li>Bastion and Jumpbox connectivity</li>
            <li>Private endpoint configurations</li>
        </ul>
    </div>
    <div class="card" style="border-left-color: #fcba19;">
        <h3 style="margin-top: 0;">Network Environments</h3>
        <p>Complete environment layout:</p>
        <ul style="margin-bottom: 0;">
            <li>All 4 VNets (da4cf6-prod/test/dev/tools)</li>
            <li>Subnet allocations per environment</li>
            <li>Canada Central (prod) vs Canada East (non-prod)</li>
            <li>Client connectivity via App Gateway + APIM</li>
            <li>NSG rules and cross-environment isolation</li>
        </ul>
    </div>
    <div class="card" style="border-left-color: #0078d4;">
        <h3 style="margin-top: 0;">Deployment Pipeline</h3>
        <p>CI/CD workflow visualization:</p>
        <ul style="margin-bottom: 0;">
            <li>Trigger conditions and branch rules</li>
            <li>Environment selection and approvals</li>
            <li>Terraform plan/apply stages</li>
            <li>State locking and backend access</li>
            <li>Notification and rollback flows</li>
        </ul>
    </div>
</div>

<h2>Using SVG Diagrams</h2>

<div class="alert alert-info">
    <span class="alert-icon">ðŸ’¡</span>
    <div>
        <strong>Why SVG?</strong><br>
        SVG diagrams are vector-based, meaning they scale infinitely without losing quality. You can zoom in to see fine details, search text within the diagram, and even modify colors or extract sections for presentations.
    </div>
</div>

<div class="card card-gold">
    <h3 style="margin-top: 0;">Tips for Working with SVG Diagrams</h3>
    <div class="grid grid-2" style="margin-top: 1rem;">
        <div>
            <h4 style="color: var(--bc-blue); margin: 0 0 0.5rem 0;">In Browser</h4>
            <ul style="margin: 0;">
                <li>Use Ctrl+F to search for text</li>
                <li>Right-click â†’ "Open image in new tab" for native zoom</li>
                <li>Browser zoom (Ctrl +/-) works on SVG</li>
            </ul>
        </div>
        <div>
            <h4 style="color: var(--bc-blue); margin: 0 0 0.5rem 0;">Downloaded</h4>
            <ul style="margin: 0;">
                <li>Open in VS Code for editing</li>
                <li>Use Inkscape for advanced modifications</li>
                <li>Import into Figma/Sketch for presentations</li>
            </ul>
        </div>
    </div>
</div>

<script>
/**
 * ============================================================================
 * SVG Diagram Viewer - Pure ES6 JavaScript (No Dependencies)
 * ============================================================================
 *
 * This viewer provides interactive zoom, pan, and fullscreen for SVG diagrams.
 * It uses only vanilla JavaScript and CSS transforms - no libraries needed.
 *
 * How it works:
 * 1. Diagrams are stored in an object with IDs, titles, and file paths
 * 2. CSS transform: scale() handles zooming (GPU-accelerated)
 * 3. Overflow: auto on the container provides panning via scrollbars
 * 4. CSS position: fixed handles fullscreen mode
 *
 * Browser Support: All modern browsers (Chrome, Firefox, Safari, Edge)
 * ============================================================================
 */

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CONFIGURATION: Diagram Registry
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Each diagram has a unique ID, display title, and path to the SVG file.
// To add a new diagram: add an entry here and a card in the HTML gallery.

const diagrams = {
    // Architecture Overview
    'architecture-layers': {
        title: 'Architecture Layers (Upstream to Deployment)',
        src: 'assets/architecture-layers.svg'
    },
    'full-stack': {
        title: 'Full Stack Architecture (BC Gov Adapted)',
        src: 'assets/full-stack-architecture.svg'
    },
    // Stakeholder Infographics (NEW)
    'tenant-rg-model': {
        title: 'Tenant Resource Group Model',
        src: 'assets/tenant-resource-group-model.svg'
    },
    'ms-vs-bcgov': {
        title: 'Microsoft vs BC Gov Comparison',
        src: 'assets/microsoft-vs-bcgov-comparison.svg'
    },
    'whats-included': {
        title: 'What\'s Included / Not Included',
        src: 'assets/whats-included-scope.svg'
    },
    'ip-budget': {
        title: 'IP Budget Breakdown',
        src: 'assets/ip-budget-breakdown.svg'
    },
    // Authentication
    'oidc-complete': {
        title: 'OIDC Complete Guide',
        src: 'assets/azure-oidc-complete-guide.svg'
    },
    'token-flow': {
        title: 'Token Exchange Flow',
        src: 'assets/token-flow.svg'
    },
    // Networking
    'network-detailed': {
        title: 'Networking Architecture (Detailed)',
        src: 'assets/networking-architecture-detailed.svg'
    },
    'network-arch': {
        title: 'Network Architecture',
        src: 'assets/network-architecture.svg'
    },
    'network-environments': {
        title: 'Network Environments (All VNets)',
        src: 'assets/network-environments.svg'
    },
    // Multi-Tenancy & Flow
    'multi-tenant': {
        title: 'Multi-Tenant Isolation Model',
        src: 'assets/multi-tenant-isolation.svg'
    },
    'data-flow': {
        title: 'AI Request Data Flow',
        src: 'assets/data-flow.svg'
    },
    'avm-nested': {
        title: 'AVM Nested Module Pattern',
        src: 'assets/avm-nested-modules.svg'
    },
    // Platform Access & Security
    'control-data-plane': {
        title: 'Control Plane vs Data Plane',
        src: 'assets/control-vs-data-plane.svg'
    },
    'access-methods': {
        title: 'Access Methods Architecture',
        src: 'assets/access-methods-architecture.svg'
    },
    'who-deploys-what': {
        title: 'Who Deploys What',
        src: 'assets/who-deploys-what.svg'
    },
    'deployment-scenarios': {
        title: 'Deployment Scenarios',
        src: 'assets/deployment-scenarios.svg'
    },
    'three-steps-evolution': {
        title: '3-Step Access Evolution',
        src: 'assets/three-steps-access-evolution.svg'
    },
    'chisel-detail': {
        title: 'Chisel Tunnel Detail',
        src: 'assets/chisel-tunnel-detail.svg'
    },
    'terraform-keyvault': {
        title: 'When Terraform Needs Key Vault',
        src: 'assets/when-terraform-needs-keyvault.svg'
    },
    // CI/CD
    'deployment-pipeline': {
        title: 'Deployment Pipeline',
        src: 'assets/deployment-pipeline.svg'
    },
    // Microsoft Reference (PNG)
    'ms-with-platform': {
        title: 'MS Reference: With Platform LZ',
        src: 'assets/AI-Landing-Zone-with-platform.png'
    },
    'ms-without-platform': {
        title: 'MS Reference: Without Platform LZ',
        src: 'assets/AI-Landing-Zone-without-platform.png'
    }
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STATE: Zoom Level Management
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Using 'let' because this value changes. Constants define boundaries.

let currentZoom = 100;      // Current zoom level as percentage (100 = actual size)
const minZoom = 25;         // Minimum zoom: 25% (zoomed out)
const maxZoom = 400;        // Maximum zoom: 400% (zoomed in)
const zoomStep = 25;        // How much to zoom per click/keypress

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FUNCTION: loadDiagram(id, element)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Loads a diagram into the viewer when user clicks a gallery card.
//
// Parameters:
//   id      - String key matching a diagram in the 'diagrams' object
//   element - The DOM element (card) that was clicked
//
// What it does:
//   1. Looks up diagram data by ID
//   2. Updates gallery cards to show which is selected
//   3. Updates the viewer with the new diagram
//   4. Resets zoom to 100%
//   5. Scrolls the viewer into view

function loadDiagram(id, element) {
    // Look up the diagram configuration
    const diagram = diagrams[id];

    // Guard clause: exit if diagram ID doesn't exist
    if (!diagram) return;

    // Update gallery cards: remove 'active' class from all cards
    // querySelectorAll returns a NodeList, forEach iterates over it
    document.querySelectorAll('.diagram-card').forEach(card => card.classList.remove('active'));

    // Add 'active' class to the clicked card (if element provided)
    if (element) element.classList.add('active');

    // Update the viewer elements with new diagram data
    // getElementById is the fastest way to find a single element by ID
    document.getElementById('currentDiagramTitle').textContent = diagram.title;
    document.getElementById('currentDiagram').src = diagram.src;
    document.getElementById('currentDiagram').alt = diagram.title;
    document.getElementById('downloadBtn').href = diagram.src;

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // DEEP LINKING: Update URL hash so users can share links to specific diagrams
    // Example: diagrams.html#network-arch links directly to the network diagram
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // history.pushState allows updating URL without page reload
    // We use replaceState to avoid cluttering browser history with each click
    if (history.replaceState) {
        history.replaceState(null, null, '#' + id);
    } else {
        // Fallback for older browsers
        window.location.hash = id;
    }

    // Reset zoom to 100% for the new diagram
    resetZoom();

    // Smooth scroll the viewer into view
    // 'behavior: smooth' animates the scroll instead of jumping
    // 'block: start' aligns the top of the viewer with the top of the viewport
    document.getElementById('diagramViewer').scrollIntoView({
        behavior: 'smooth',
        block: 'start'
    });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FUNCTION: updateZoom()
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Applies the current zoom level to the SVG wrapper element.
//
// How CSS transform: scale() works:
//   - scale(1) = 100% = actual size
//   - scale(2) = 200% = twice as large
//   - scale(0.5) = 50% = half size
//
// We divide by 100 to convert our percentage to the decimal scale() expects.
// The transform is GPU-accelerated, making it smooth even for large SVGs.

function updateZoom() {
    const wrapper = document.getElementById('svgWrapper');

    // Apply CSS transform with template literal for string interpolation
    // Example: currentZoom=150 becomes "scale(1.5)"
    wrapper.style.transform = `scale(${currentZoom / 100})`;

    // Update the zoom percentage display in the toolbar
    document.getElementById('zoomLevel').textContent = currentZoom + '%';
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FUNCTION: zoomIn()
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Increases zoom level by zoomStep (25%).
// Uses Math.min to ensure we never exceed maxZoom.

function zoomIn() {
    // Only zoom if we haven't hit the maximum
    if (currentZoom < maxZoom) {
        // Add zoomStep, but cap at maxZoom
        // Math.min(a, b) returns the smaller value
        currentZoom = Math.min(currentZoom + zoomStep, maxZoom);
        updateZoom();
    }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FUNCTION: zoomOut()
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Decreases zoom level by zoomStep (25%).
// Uses Math.max to ensure we never go below minZoom.

function zoomOut() {
    // Only zoom if we haven't hit the minimum
    if (currentZoom > minZoom) {
        // Subtract zoomStep, but floor at minZoom
        // Math.max(a, b) returns the larger value
        currentZoom = Math.max(currentZoom - zoomStep, minZoom);
        updateZoom();
    }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FUNCTION: resetZoom()
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Resets zoom to 100% (actual size) and scrolls to top-left corner.

function resetZoom() {
    currentZoom = 100;
    updateZoom();

    // Reset scroll position to top-left
    // scrollTo(x, y) sets the scroll position in pixels
    document.getElementById('diagramContainer').scrollTo(0, 0);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FUNCTION: fitToWidth()
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Calculates and applies the zoom level that makes the diagram fit the
// container width exactly.
//
// Math:
//   zoom = (containerWidth / imageWidth) * 100
//   Example: 800px container / 1600px image = 0.5 * 100 = 50%

function fitToWidth() {
    const container = document.getElementById('diagramContainer');
    const img = document.getElementById('currentDiagram');

    // clientWidth = visible width of element (excludes scrollbar)
    // Subtract 40 for padding (20px on each side)
    const containerWidth = container.clientWidth - 40;

    // naturalWidth = actual image width in pixels
    // Fallback to 1600 if image hasn't loaded yet
    const imgWidth = img.naturalWidth || 1600;

    // Calculate zoom percentage
    // Math.round removes decimal places for cleaner display
    currentZoom = Math.round((containerWidth / imgWidth) * 100);

    // Clamp to min/max bounds
    // This nested Math.max/min ensures: minZoom <= currentZoom <= maxZoom
    currentZoom = Math.max(minZoom, Math.min(maxZoom, currentZoom));

    updateZoom();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FUNCTION: toggleFullscreen()
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Toggles between normal and fullscreen mode.
//
// Implementation: We use CSS classes rather than the Fullscreen API because:
//   1. Works consistently across all browsers
//   2. No permissions prompts required
//   3. Simpler to implement and style
//
// The CSS for .fullscreen uses position: fixed to cover the viewport.

function toggleFullscreen() {
    const viewer = document.getElementById('diagramViewer');
    const btn = document.getElementById('fullscreenBtn');

    // classList.contains() returns true/false if class is present
    if (viewer.classList.contains('fullscreen')) {
        // Exit fullscreen mode
        viewer.classList.remove('fullscreen');
        btn.innerHTML = 'â›¶ Fullscreen';

        // Re-enable page scrolling
        // Setting overflow to empty string removes inline style,
        // falling back to stylesheet default
        document.body.style.overflow = '';
    } else {
        // Enter fullscreen mode
        viewer.classList.add('fullscreen');
        btn.innerHTML = 'âœ• Exit';

        // Disable page scrolling while in fullscreen
        // 'hidden' prevents scrollbars and scroll behavior
        document.body.style.overflow = 'hidden';
    }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// EVENT LISTENER: Keyboard Shortcuts
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Adds keyboard controls for power users.
//
// addEventListener('keydown', callback) fires when any key is pressed.
// The event object (e) contains information about which key was pressed.

document.addEventListener('keydown', function(e) {
    // Don't trigger shortcuts if user is typing in a form field
    // e.target is the element that received the event
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

    // e.key contains the key value as a string
    switch(e.key) {
        case '+':
        case '=':  // '=' is the key for '+' without holding Shift
            e.preventDefault();  // Stop browser's default zoom behavior
            zoomIn();
            break;

        case '-':
            e.preventDefault();
            zoomOut();
            break;

        case '0':
            e.preventDefault();
            resetZoom();
            break;

        case 'w':
        case 'W':
            e.preventDefault();
            fitToWidth();
            break;

        case 'f':
        case 'F':
            e.preventDefault();
            toggleFullscreen();
            break;

        case 'Escape':
            // Only exit fullscreen if currently in fullscreen
            const viewer = document.getElementById('diagramViewer');
            if (viewer.classList.contains('fullscreen')) {
                toggleFullscreen();
            }
            break;
    }
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// EVENT LISTENER: Mouse Wheel Zoom
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Enables Ctrl+Scroll to zoom (like Google Maps).
//
// The 'wheel' event fires when the mouse wheel is scrolled.
// e.deltaY indicates scroll direction:
//   - Negative = scrolling up (zoom in)
//   - Positive = scrolling down (zoom out)

document.getElementById('diagramContainer').addEventListener('wheel', function(e) {
    // Only zoom if Ctrl key is held down
    // This prevents interfering with normal page scrolling
    if (e.ctrlKey) {
        // Prevent the browser's default zoom behavior
        e.preventDefault();

        // Check scroll direction and zoom accordingly
        if (e.deltaY < 0) {
            zoomIn();   // Scroll up = zoom in
        } else {
            zoomOut();  // Scroll down = zoom out
        }
    }
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// EVENT LISTENER: DOMContentLoaded
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Runs initialization code when the DOM is fully loaded.
// This ensures all HTML elements exist before we try to use them.

document.addEventListener('DOMContentLoaded', function() {
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // DEEP LINKING: Check URL hash on page load
    // If user visits diagrams.html#network-arch, load that diagram directly
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if (window.location.hash) {
        // Remove the '#' prefix to get the diagram ID
        const id = window.location.hash.substring(1);

        // Check if this ID exists in our diagrams object
        if (diagrams[id]) {
            // Find the corresponding gallery card using attribute selector
            // This finds the card whose onclick contains the diagram ID
            const card = document.querySelector(`.diagram-card[onclick*="'${id}'"]`);
            loadDiagram(id, card);
            return; // Exit early, don't load default
        }
    }

    // No hash or invalid hash - load the first diagram by default
    // querySelector returns the first matching element
    loadDiagram('architecture-layers', document.querySelector('.diagram-card'));
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// EVENT LISTENER: hashchange
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Handles browser back/forward navigation between diagrams
// When user clicks back button, this loads the previous diagram

window.addEventListener('hashchange', function() {
    if (window.location.hash) {
        const id = window.location.hash.substring(1);
        if (diagrams[id]) {
            const card = document.querySelector(`.diagram-card[onclick*="'${id}'"]`);
            // Don't scroll on back/forward navigation
            document.querySelectorAll('.diagram-card').forEach(c => c.classList.remove('active'));
            if (card) card.classList.add('active');
            document.getElementById('currentDiagramTitle').textContent = diagrams[id].title;
            document.getElementById('currentDiagram').src = diagrams[id].src;
            document.getElementById('downloadBtn').href = diagrams[id].src;
            resetZoom();
        }
    }
});

/**
 * ============================================================================
 * CSS Explained (key styles from the <style> block above)
 * ============================================================================
 *
 * .diagram-svg-wrapper {
 *     transform-origin: top left;  // Scale from top-left corner
 *     transition: transform 0.3s;  // Smooth animation when zooming
 * }
 *
 * .diagram-container {
 *     overflow: auto;              // Enables scrollbars for panning
 *     max-height: 80vh;            // Limits height to 80% of viewport
 * }
 *
 * .diagram-viewer.fullscreen {
 *     position: fixed;             // Removes from document flow
 *     top: 0; left: 0;             // Positions at top-left of viewport
 *     right: 0; bottom: 0;         // Stretches to fill viewport
 *     z-index: 9999;               // Ensures it's above other content
 * }
 *
 * ============================================================================
 */
</script>
